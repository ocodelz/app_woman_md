"use strict";module.exports=tokenize;var delimRe=/[\s{}=;:[\],'"()<>]/g,stringDoubleRe=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,stringSingleRe=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,setCommentRe=/^ *[*/]+ */,setCommentAltRe=/^\s*\*?\/*/,setCommentSplitRe=/\n/g,whitespaceRe=/\s/,unescapeRe=/\\(.?)/g,unescapeMap={0:"\0",r:"\r",n:"\n",t:"\t"};function unescape(e){return e.replace(unescapeRe,function(e,n){switch(n){case"\\":case"":return n;default:return unescapeMap[n]||""}})}function tokenize(s,o){s=s.toString();var f=0,a=s.length,c=1,l=null,m=null,p=0,g=!1,h=[],R=null;function d(e){return Error("illegal "+e+" (line "+c+")")}function v(e){return s.charAt(e)}function w(e,n){l=s.charAt(e++),p=c,g=!1;var t,r=e-(o?2:3);do{if(--r<0||"\n"===(t=s.charAt(r))){g=!0;break}}while(" "===t||"\t"===t);for(var i=s.substring(e,n).split(setCommentSplitRe),u=0;u<i.length;++u)i[u]=i[u].replace(o?setCommentAltRe:setCommentRe,"").trim();m=i.join("\n").trim()}function b(e){var n=k(e),t=s.substring(e,n);return/^\s*\/{1,2}/.test(t)}function k(e){for(var n=e;n<a&&"\n"!==v(n);)n++;return n}function r(){if(0<h.length)return h.shift();if(R)return function(){var e="'"===R?stringSingleRe:stringDoubleRe;e.lastIndex=f-1;var n=e.exec(s);if(!n)throw d("string");return f=e.lastIndex,x(R),R=null,unescape(n[1])}();var e,n,t,r,i;do{if(f===a)return null;for(e=!1;whitespaceRe.test(t=v(f));)if("\n"===t&&++c,++f===a)return null;if("/"===v(f)){if(++f===a)throw d("comment");if("/"===v(f))if(o){if(i=!1,b(r=f)){i=!0;do{if((f=k(f))===a)break;f++}while(b(f))}else f=Math.min(a,k(f)+1);i&&w(r,f),c++,e=!0}else{for(i="/"===v(r=f+1);"\n"!==v(++f);)if(f===a)return null;++f,i&&w(r,f-1),++c,e=!0}else{if("*"!==(t=v(f)))return"/";r=f+1,i=o||"*"===v(r);do{if("\n"===t&&++c,++f===a)throw d("comment");n=t,t=v(f)}while("*"!==n||"/"!==t);++f,i&&w(r,f-2),e=!0}}}while(e);var u=f;if(delimRe.lastIndex=0,!delimRe.test(v(u++)))for(;u<a&&!delimRe.test(v(u));)++u;var l=s.substring(f,f=u);return'"'!==l&&"'"!==l||(R=l),l}function x(e){h.push(e)}function i(){if(!h.length){var e=r();if(null===e)return null;x(e)}return h[0]}return Object.defineProperty({next:r,peek:i,push:x,skip:function(e,n){var t=i();if(t===e)return r(),!0;if(!n)throw d("token '"+t+"', '"+e+"' expected");return!1},cmnt:function(e){var n=null;return void 0===e?p===c-1&&(o||"*"===l||g)&&(n=m):(p<e&&i(),p!==e||g||!o&&"/"!==l||(n=m)),n}},"line",{get:function(){return c}})}tokenize.unescape=unescape;