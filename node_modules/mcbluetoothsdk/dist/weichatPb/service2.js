"use strict";module.exports=Service;var util=require("./util");function Service(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}((Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service).prototype.rpcCall=function e(r,t,i,n,o){if(!n)throw TypeError("request must be specified");var l=this;if(!o)return util.asPromise(e,l,r,t,i,n);if(l.rpcImpl)try{return l.rpcImpl(r,t[l.requestDelimited?"encodeDelimited":"encode"](n).finish(),function(e,t){if(e)return l.emit("error",e,r),o(e);if(null!==t){if(!(t instanceof i))try{t=i[l.responseDelimited?"decodeDelimited":"decode"](t)}catch(e){return l.emit("error",e,r),o(e)}return l.emit("data",t,r),o(null,t)}l.end(!0)})}catch(e){return l.emit("error",e,r),void setTimeout(function(){o(e)},0)}else setTimeout(function(){o(Error("already ended"))},0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};