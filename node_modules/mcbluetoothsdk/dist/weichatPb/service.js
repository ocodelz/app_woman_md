"use strict";module.exports=Service;var Method,util,rpc,Namespace=require("./namespace");function Service(e,t){Namespace.call(this,e,t),this.methods={},this._methodsArray=null}function clearCache(e){return e._methodsArray=null,e}((Service.prototype=Object.create(Namespace.prototype)).constructor=Service).className="Service",Service.fromJSON=function(e,t){var r=new Service(e,t.options);if(t.methods)for(var o=Object.keys(t.methods),s=0;s<o.length;++s)r.add(Method.fromJSON(o[s],t.methods[o[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r},Service.prototype.toJSON=function(e){var t=Namespace.prototype.toJSON.call(this,e),r=!!e&&Boolean(e.keepComments);return util.toObject(["options",t&&t.options||void 0,"methods",Namespace.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(Service.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=util.toArray(this.methods))}}),Service.prototype.get=function(e){return this.methods[e]||Namespace.prototype.get.call(this,e)},Service.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return Namespace.prototype.resolve.call(this)},Service.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof Method?clearCache((this.methods[e.name]=e).parent=this):Namespace.prototype.add.call(this,e)},Service.prototype.remove=function(e){if(e instanceof Method){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,clearCache(this)}return Namespace.prototype.remove.call(this,e)},Service.prototype.create=function(e,t,r){for(var o,s=new rpc.Service(e,t,r),i=0;i<this.methodsArray.length;++i){var c=util.lcFirst((o=this._methodsArray[i]).resolve().name).replace(/[^$\w_]/g,"");s[c]=util.codegen(["r","c"],util.isReserved(c)?c+"_":c)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return s},Service._configure=function(){Method=require("./method"),util=require("./util"),rpc=require("./rpc/service")};