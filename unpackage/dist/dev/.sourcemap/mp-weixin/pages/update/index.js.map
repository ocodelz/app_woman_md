{"version":3,"sources":["uni-app:///main.js","webpack:///E:/SK.PwGuard.App/app_woman/pages/update/index.vue?6832","webpack:///E:/SK.PwGuard.App/app_woman/pages/update/index.vue?f8a6","webpack:///E:/SK.PwGuard.App/app_woman/pages/update/index.vue?49fb","webpack:///E:/SK.PwGuard.App/app_woman/pages/update/index.vue?aaf0","uni-app:///pages/update/index.vue","webpack:///E:/SK.PwGuard.App/app_woman/pages/update/index.vue?a699","webpack:///E:/SK.PwGuard.App/app_woman/pages/update/index.vue?db6e"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA,wCAAmB;AACnB;AACA,8F;AACAA,UAAU,CAACC,cAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA8H;AAC9H;AACyD;AACL;AACqC;;;AAGzF;AACgO;AAChO,gBAAgB,uOAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,4FAAM;AACR,EAAE,qGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,gGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAs4B,CAAgB,i5BAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACkE15B,yE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,6E,eACA,EACA,cADA,EAEA,IAFA,kBAEA,CACA,SACA,oBADA,EAEA,2BAFA,EAGA,mBAHA,EAIA,uBAJA,EAKA,yBALA,EAMA,YANA,EAMA;AACA,kBAPA,EAOA;AACA,cARA,EAQA;AACA,+BATA,EASA;AAEA,kBAXA,EAWA;AACA,sBAZA,EAYA;AACA,sBAbA,EAaA;AACA,wBAdA,EAcA;AACA,yBAfA,EAeA;AAEA,0BAjBA,EAiBA;AACA,sBAlBA,EAkBA;AACA,0BAnBA,EAmBA;AACA,2BApBA,CAoBA;AApBA,MAsBA,CAzBA,EA0BA,OA1BA,qBA0BA,CACA;AACA,6BACA,iBACA,4CACA,yBACA,qCACA,CACA,4BACA,aADA,IARA,CAWA;AACA,GAtCA,EAuCA;AACA,QAxCA,oBAwCA,CAOA,iDACA,uBACA,sBACA,CAVA,CAWA;;;;;;;;;;;;;;;;gIAiBA,CApEA,EAqEA;AACA,UAtEA,sBAsEA,CACA;AACA,4BACA,iBADA,CAEA;AACA,KALA,CAMA;AACA,GA7EA,EA8EA;AACA,mBA/EA,+BA+EA,CACA;AACA,qBACA,0BAHA,CAIA;AACA,GApFA,EAqFA,WACA,YADA,0BACA,CACA,qEADA,CACA;AAEA,mCACA,CALA,EAMA;AACA,aAPA,qBAOA,IAPA,EAOA,CACA,gBACA,WADA,EAEA,cAFA,EAGA,YAHA,IAKA,CAbA,EAcA,aAdA,2BAcA,oBACA;AACA,6DACA,sBAHA,CAIA;AACA,uBACA,cADA,EAEA;AACA,yBADA;AAEA,qCAFA,EAFA;;AAMA;AACA;AACA;AACA;AACA,SAVA;;AAYA;AACA;AACA;AACA;AACA,qBADA;AAEA,+BAFA;AAGA,2BAHA;AAIA;AACA;AACA,WANA;;AAQA;AACA,KA3CA;AA4CA;AACA,kBA7CA,4BA6CA;AACA;AACA;AACA,uBADA;AAEA,mDAFA;AAGA;AACA;AACA;AACA;AACA,WAHA,MAGA;AACA;AACA;AACA,SAVA;;AAYA,KA3DA;AA4DA;AACA,aA7DA,uBA6DA;AACA;AACA,yBAFA,CAEA;AACA,wBAHA,CAGA;AACA,4BAJA,CAIA;;AAEA;AACA;AACA;AACA;AACA;AACA,mCADA,EACA;AACA,kBAFA,oBAEA,GAFA,EAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,qBADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,mBAFA;AAGA;AACA;AACA,mBAFA;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mBATA;AAUA;AACA,iBApBA;AAqBA,eAxBA;AAyBA;AACA;AACA,eA3BA;;AA6BA;AACA,WA1CA;;AA4CA,OA7CA,CA6CA;AACA;AACA;AACA,KAtHA;AAuHA,QAvHA,kBAuHA;AACA;AACA;AACA,KA1HA;AA2HA;AACA,eA5HA,yBA4HA;AACA;;AAEA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA;AACA,gEAJA,CAIA;AACA;AACA,+EANA,CAMA;AACA;AACA;AACA,OATA,MASA;AACA;AACA;AACA;AACA,gEAJA,CAIA;AACA;AACA;AACA;AACA;AACA,KAnJA;AAoJA;AACA,YArJA,oBAqJA,IArJA,EAqJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAjBA;;AAmBA,KAzKA;AA0KA;AACA,aA3KA,uBA2KA;AACA;AACA;AACA;AACA,KA/KA;AAgLA;AACA,cAjLA,sBAiLA,YAjLA,EAiLA;AACA;AACA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA;AACA;AACA,2BADA;AAEA;AACA;AACA;AACA;AACA,8CADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBARA;;AAUA;AACA,WAhBA;;AAkBA;AACA;AACA;AACA,SAFA;AAGA;AACA,KAjNA;AAkNA,gBAlNA,0BAkNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAJA,MAIA;AACA;AACA;AACA,OARA,MAQA;AACA;AACA;AACA;AACA;AACA;AACA,WAFA,MAEA;AACA;AACA;AACA;AACA,SATA,MASA;AACA;AACA;AACA;AACA,KA1OA,EArFA,E;;;;;;;;;;;;;ACpEA;AAAA;AAAA;AAAA;AAAsyC,CAAgB,kxCAAG,EAAC,C;;;;;;;;;;;ACA1zC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/update/index.js","sourcesContent":["import 'uni-pages';import '@dcloudio/uni-stat';\nimport Vue from 'vue'\nimport Page from './pages/update/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=0e7ddb05&scoped=true&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=0e7ddb05&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0e7ddb05\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/update/index.vue\"\nexport default component.exports","export * from \"-!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=template&id=0e7ddb05&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"flex-column\">\r\n\t\t<view class=\"content\">\r\n\t\t\t<image class=\"logo imgloading\" src=\"../../static/logos/8080.png\" />\r\n\t\t\t<view class=\"mainInfo\">\r\n\t\t\t\t<text class=\"title\">{{ info }} | {{ Minfo }}</text>\r\n\t\t\t\t<text class=\"tip\">\\n{{ Mtip }}</text>\r\n\t\t\t</view>\r\n\t\t\t<text class=\"line\" />\r\n\t\t</view>\r\n\t\t<view class=\"content\">\r\n\t\t\t<view class=\"infoContentTitle\">\r\n\t\t\t\t<image class=\"infoPic imgloading\" src=\"../../static/update/info-circle.png\" />\r\n\t\t\t\t<text class=\"infoTitle\">功能摘要</text>\r\n\t\t\t</view>\r\n\t\t\t<view v-if=\"bShowAppStoreUptCont\" style=\"width: 50%;font-size: small; margin-top: 5upx;\">\r\n\t\t\t\t<view v-if=\"bGotoAppStore\" style=\"color: #007AFF; font-size:small;margin-bottom: 5upx;\">\r\n\t\t\t\t\t<text>发现新版本:V{{ appStoreVersion }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view>\r\n\t\t\t\t\t<view style=\"color: #007AFF; font-size:small;margin-bottom: 5upx;\">发布时间:{{ appStoreReleasedate }}</view>\r\n\t\t\t\t\t<textarea auto-height disabled :value=\"appStoreUpdateContent\"></textarea>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view v-if=\"!bShowAppStoreUptCont\" class=\"infoContent\">\r\n\t\t\t\t<text class=\"updateInfo\">{{ updateInfo }}</text>\r\n\t\t\t</view>\r\n\t\t\t<view style=\"border-top: #007AFF;font-size: small; border-width: thick;margin-top: 15upx;\">\r\n\t\t\t\t<view><text class=\"line\" /></view>\r\n\t\t\t\t<view v-show=\"bGotoAppStore\" style=\"text-align: center;\">\r\n\t\t\t\t\t<button :disabled=\"!bGotoAppStore\" size=\"mini\" @click=\"gotoAppStore\" type=\"primary\">立即更新</button>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view v-show=\"!bGotoAppStore\" style=\"text-align: center;\">\r\n\t\t\t\t\t<button size=\"mini\" v-if=\"!startProgress && !currentIsLatest\" type=\"primary\" @tap=\"handleUpdate()\">立即更新</button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t</view>\r\n\t\t<view class=\"content\" v-if=\"!currentIsLatest\">\r\n\t\t\t<view class=\"infoContentTitle\">\r\n\t\t\t\t<image class=\"infoPic imgloading\" src=\"../../static/update/sync.png\" />\r\n\t\t\t\t<text class=\"infoTitle\">更新大小</text>\r\n\t\t\t\t<text class=\"updateInfo\">{{ packgeSize }}</text>\r\n\t\t\t</view>\r\n\t\t\t<!-- <view class=\"infoContent\">\r\n\t\t\t\t\r\n\t\t\t</view> -->\r\n\t\t</view>\r\n\t\t<view class=\"minorContent bottom_aera\">\r\n\t\t\t<view v-if=\"startProgress && !currentIsLatest\" class=\"smallTitle\">\r\n\t\t\t\t<text>下载进度:{{ downloadProgress }}%</text>\r\n\t\t\t\t<progress :percent=\"downloadProgress\" stroke-width=\"4\" />\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- \t<button style=\"width :400upx;line-height: 80upx; font-size: 30upx;height: 80upx;\" v-if=\"!startProgress && !currentIsLatest\" type=\"primary\" @tap=\"handleUpdate()\">\r\n\t\t\t\t立即更新\r\n\t\t\t</button> -->\r\n\t\t\t<!-- <button style=\"line-height: 80upx; width :400upx;font-size: 30upx;height: 80upx;\" v-if=\"currentIsLatest\" :loading=\"buttonLoading\" type=\"primary\" @tap=\"getLatest()\">\r\n\t\t\t\t检查更新\r\n\t\t\t</button> -->\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport { baseUrl, serverUrl, updateUrl } from '@/service/ServerInfo.js';\r\nconst updaterServerAddress = updateUrl + '/versioninfopwguard.txt';\r\nexport default {\r\n\tcomponents: {},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tbGotoAppStore: false,\r\n\t\t\tbShowAppStoreUptCont: false,\r\n\t\t\tappStoreVersion: '',\r\n\t\t\tappStoreReleasedate: '',\r\n\t\t\tappStoreUpdateContent: '',\r\n\t\t\tinfo: '正在加载', // 主标题显示版本号\r\n\t\t\tMinfo: '正式版', // 副标题显示版本类型\r\n\t\t\tMtip: '', // 小提示标语\r\n\t\t\tupdateInfo: '幼儿英语学习及育儿指导', // 更新摘要\r\n\r\n\t\t\tlatest: null, // 版本信息\r\n\t\t\tpackgeSize: null, // 更新包大小\r\n\t\t\tpackgePath: null, // 更新包的文件地址\r\n\t\t\tdownloadTask: null, // 下载任务\r\n\t\t\tdownloadProgress: 0, // 下载进度\r\n\r\n\t\t\tbuttonLoading: false, // 加载 - 标记\r\n\t\t\tinstalled: false, // 是否执行了安装 - 标记\r\n\t\t\tstartProgress: false, // 下载进行 - 标记\r\n\t\t\tcurrentIsLatest: true // 当前版本就是最新版本 - 标记\r\n\t\t};\r\n\t},\r\n\tonReady() {\r\n\t\t//if (uni.getSystemInfoSync().platform != 'ios') {\r\n\t\tconsole.log('onReady-1');\r\n\t\tthis.getLatest();\r\n\t\tconst updated = uni.getStorageSync('updated');\r\n\t\tif (updated.packgePath) {\r\n\t\t\tthis.packgePath = updated.packgePath;\r\n\t\t}\r\n\t\tuni.setNavigationBarTitle({\r\n\t\t\ttitle: '版本信息'\r\n\t\t});\r\n\t\t//}\r\n\t},\r\n\t// 如果用户下载后没有完成安装，却回到app，则执行这里\r\n\tonShow() {\r\n\t\t//#ifdef APP-PLUS\r\n\t\tplus.runtime.getProperty(plus.runtime.appid, wgtinfo => {\r\n\t\t\tthis.info = wgtinfo.name + wgtinfo.version.toString();\r\n\t\t});\r\n\t\t//#endif\r\n\r\n\t\tif (this.installed === true && this.packgePath) {\r\n\t\t\tthis.installed = false;\r\n\t\t\tthis.haveDownloaded();\r\n\t\t}\r\n\t\t/*if (uni.getSystemInfoSync().platform != 'ios') {\n\t\t\tif (this.installed === true && this.packgePath) {\n\t\t\t\tthis.installed = false;\n\t\t\t\tthis.haveDownloaded();\n\t\t\t}\n\t\t} else {\n\t\t\tthis.appStoreVersion = this.$current.appstoreversion||'未知';\n\t\t\tthis.appStoreReleasedate = this.$current.appstorereleasedate||'未知'\n\t\t\t\n\t\t\tthis.appStoreUpdateContent = this.$current.appstoreupdatecontent;\n\t\t\tif (this.$current.appstoreversion !== this.$current.appcurrentversion) {\n\t\t\t\tthis.bGotoAppStore = true;\n\t\t\t} else {\n\t\t\t\tthis.bGotoAppStore = false;\n\t\t\t}\n\t\t\tthis.bShowAppStoreUptCont = true;\n\t\t}*/\r\n\t},\r\n\t// 用户关闭页面时检查是否存在下载任务\r\n\tonUnload() {\r\n\t\t//if (uni.getSystemInfoSync().platform != 'ios') {\r\n\t\tif (this.downloadTask) {\r\n\t\t\tthis.closeTask();\r\n\t\t\t//this.showToast('更新被取消');\r\n\t\t}\r\n\t\t//}\r\n\t},\r\n\t// 下拉刷新更新\r\n\tonPullDownRefresh() {\r\n\t\t//if (uni.getSystemInfoSync().platform != 'ios') {\r\n\t\tthis.getLatest();\r\n\t\tuni.stopPullDownRefresh();\r\n\t\t//}\r\n\t},\r\n\tmethods: {\r\n\t\tgotoAppStore() {\r\n\t\t\tlet appUrl = 'itms-apps://itunes.apple.com/cn/app/id1471975642?mt=8'; // XXXX为对应的AppID\r\n\r\n\t\t\tplus.runtime.openURL(appUrl);\r\n\t\t},\r\n\t\t// 封装个Toast方便用\r\n\t\tshowToast(text) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: text,\r\n\t\t\t\tduration: 3000,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t});\r\n\t\t},\r\n\t\tinstallPackge() {\r\n\t\t\t// 安装更新\r\n\t\t\tplus.runtime.install(this.packgePath, { force: true });\r\n\t\t\tthis.installed = true;\r\n\t\t\t// 保存更新记录到stroage，方便下次启动app时删除安装包\r\n\t\t\tuni.setStorage({\r\n\t\t\t\tkey: 'updated',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tcompleted: true,\r\n\t\t\t\t\tpackgePath: this.packgePath\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t//console.log('成功保存更新记录');\r\n\t\t\t\t\tuni.setStorageSync('localVersionID', { id: this.latest.id });\r\n\t\t\t\t\t//console.log('localVersionID已更新,' + this.latest.id);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t// 判断是否为热更新（判断文件名中是否含有.wgt）\r\n\t\t\tif (this.packgePath.match(RegExp(/.wgt/))) {\r\n\t\t\t\tthis.installed = false;\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '应用将重启以完成更新',\r\n\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tplus.runtime.restart();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 已经下载了更新包但是没有安装\r\n\t\thaveDownloaded() {\r\n\t\t\tlet _this = this;\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: '更新尚未完成',\r\n\t\t\t\tcontent: '您已下载更新包，但是还没有完成安装，请问是否要继续安装更新包呢？',\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t// 安装\r\n\t\t\t\t\t\t_this.installPackge();\r\n\t\t\t\t\t} else if (res.cancel) {\r\n\t\t\t\t\t\t_this.showToast('更新被取消');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 取得最新版本及其所有信息\r\n\t\tgetLatest() {\r\n\t\t\tlet _this = this;\r\n\t\t\tthis.info = '正在加载'; // 主标题显示版本号\r\n\t\t\tthis.Minfo = '未知'; // 副标题显示版本类型\r\n\t\t\tthis.updateInfo = '无'; // 更新摘要\r\n\r\n\t\t\tthis.buttonLoading = true;\r\n\t\t\tthis.latest = null;\r\n\t\t\tconsole.log(updaterServerAddress);\r\n\t\t\ttry {\r\n\t\t\t\tuni.downloadFile({\r\n\t\t\t\t\turl: updaterServerAddress, //仅为示例，并非真实的资源\r\n\t\t\t\t\tcomplete(res) {\r\n\t\t\t\t\t\tif (res.statusCode === 200) {\r\n\t\t\t\t\t\t\t//_this.showToast('下载文件成功');\r\n\r\n\t\t\t\t\t\t\tlet tmpPath = res.tempFilePath;\r\n\t\t\t\t\t\t\tlet index = tmpPath.lastIndexOf('/');\r\n\t\t\t\t\t\t\tlet fileName = tmpPath.substr(index + 1);\r\n\t\t\t\t\t\t\tlet path = tmpPath.substr(0, index);\r\n\t\t\t\t\t\t\t//_this.showToast('文件路径' + path + ',' + '文件名' + fileName);\r\n\r\n\t\t\t\t\t\t\tplus.io.resolveLocalFileSystemURL(\r\n\t\t\t\t\t\t\t\ttmpPath,\r\n\t\t\t\t\t\t\t\tfunction(entry) {\r\n\t\t\t\t\t\t\t\t\tentry.file(function(file) {\r\n\t\t\t\t\t\t\t\t\t\t//读取文件内容\r\n\t\t\t\t\t\t\t\t\t\tlet read = new plus.io.FileReader();\r\n\t\t\t\t\t\t\t\t\t\tread.onerror = res => {\r\n\t\t\t\t\t\t\t\t\t\t\t_this.showToast('onerror=' + JSON.stringify(res));\r\n\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\tread.onloadend = res => {\r\n\t\t\t\t\t\t\t\t\t\t//\t_this.showToast('onload=' + JSON.stringify(res));\r\n\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\tread.onload = res => {\r\n\t\t\t\t\t\t\t\t\t\t\tlet fileContent = JSON.parse(res.target.result);\r\n\t\t\t\t\t\t\t\t\t\t\t//_this.showToast('下载的文件内容' + JSON.stringify(fileContent));\r\n\t\t\t\t\t\t\t\t\t\t\t_this.latest = fileContent.latest.info;\r\n\t\t\t\t\t\t\t\t\t\t\t//this.showToast('downloadFile id=' + _this.latest.id)\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t_this.buttonLoading = false;\r\n\t\t\t\t\t\t\t\t\t\t\t//this.test()\r\n\t\t\t\t\t\t\t\t\t\t\t_this.checkLatest();\r\n\t\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t\t\tread.readAsText(file, 'UTF-8');\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfunction(e) {\r\n\t\t\t\t\t\t\t\t\t_this.showToast('Resolve file URL failed: ' + e.message);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} catch (err) {\r\n\t\t\t\t_this.showToast('getLatest 错误' + err.message);\r\n\t\t\t}\r\n\t\t},\r\n\t\ttest() {\r\n\t\t\tconsole.log('test');\r\n\t\t\t//this.showToast('checkLatest2 id=' + this.latest.id);\r\n\t\t},\r\n\t\t// 检查版本\r\n\t\tcheckLatest() {\r\n\t\t\t//this.showToast('checkLatest2 id=' + this.latest.id);\r\n\r\n\t\t\tif (!this.latest.id) {\r\n\t\t\t\tthis.Mtip = '未找到发行版本';\r\n\t\t\t} else if (this.$current.id != this.latest.id) {\r\n\t\t\t\t// 当前版本与新版本不符（$current在main.js里）\r\n\t\t\t\tthis.currentIsLatest = false;\r\n\t\t\t\tthis.Mtip = '发现新版本';\r\n\t\t\t\tthis.info = this.latest.name + ' ' + this.latest.number; //名称 版本号\r\n\t\t\t\tthis.updateInfo = this.latest.info;\r\n\t\t\t\tthis.packgeSize = (this.latest.packgeSize / 1048576).toFixed(2) + 'MB'; // 请求取得的packgeSize是字节大小，转换为保留两位小数的MB\r\n\t\t\t\tthis.setMinfo(this.latest.type);\r\n\t\t\t\t// this.showToast('发现新版本,请点击下面的[立即更新]按钮进行升级!');\r\n\t\t\t} else {\r\n\t\t\t\t//this.showToast('当前是最新版了');\r\n\t\t\t\tthis.currentIsLatest = true;\r\n\t\t\t\tthis.Mtip = '当前是最新版';\r\n\t\t\t\tthis.info = this.latest.name + ' ' + this.latest.number; //名称 版本号\r\n\t\t\t\tthis.updateInfo = this.latest.info;\r\n\t\t\t\tthis.setMinfo(this.latest.type);\r\n\t\t\t\tthis.showToast('当前已经是最新版了!');\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 根据英文版本类型选择中文版本类型\r\n\t\tsetMinfo(type) {\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'base':\r\n\t\t\t\t\tthis.Minfo = '结构版';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'alpha':\r\n\t\t\t\t\tthis.Minfo = '内测版';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'beta':\r\n\t\t\t\t\tthis.Minfo = '公测版';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'rc':\r\n\t\t\t\t\tthis.Minfo = '终测版';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'release':\r\n\t\t\t\t\tthis.Minfo = '正式版';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis.Minfo = '未知';\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 关闭下载任务\r\n\t\tcloseTask() {\r\n\t\t\tthis.downloadTask.abort();\r\n\t\t\tthis.downloadTask = null;\r\n\t\t\tthis.startProgress = false;\r\n\t\t},\r\n\t\t// 开始下载任务\r\n\t\tcreateTask(downloadLink) {\r\n\t\t\tlet _this = this;\r\n\t\t\t//判断是否已经存在任务\r\n\t\t\tif (this.packgePath) {\r\n\t\t\t\tthis.haveDownloaded();\r\n\t\t\t} else {\r\n\t\t\t\tthis.downloadProgress = 0;\r\n\t\t\t\tthis.startProgress = true;\r\n\t\t\t\t// 创建下载任务对象\r\n\t\t\t\tthis.downloadTask = uni.downloadFile({\r\n\t\t\t\t\turl: downloadLink,\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tif (res.statusCode === 200) {\r\n\t\t\t\t\t\t\t// 保存下载的安装包\r\n\t\t\t\t\t\t\tuni.saveFile({\r\n\t\t\t\t\t\t\t\ttempFilePath: res.tempFilePath,\r\n\t\t\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\t\t\t_this.packgePath = res.savedFilePath;\r\n\t\t\t\t\t\t\t\t\t// 进行安装\r\n\t\t\t\t\t\t\t\t\t_this.installPackge();\r\n\t\t\t\t\t\t\t\t\t// 任务完成，关闭下载任务\r\n\t\t\t\t\t\t\t\t\t_this.closeTask();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// 进度条更新\r\n\t\t\t\tthis.downloadTask.onProgressUpdate(res => {\r\n\t\t\t\t\tthis.downloadProgress = res.progress;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\thandleUpdate() {\r\n\t\t\t// 判断系统类型\r\n\t\t\tif (plus.os.name.toLowerCase() === 'android') {\r\n\t\t\t\tif (this.latest.androidLink && this.latest.androidLink !== '#') {\r\n\t\t\t\t\t// 我这里默认#也是没有地址，请根据业务自行修改\r\n\t\t\t\t\t// 安卓：创建下载任务\r\n\t\t\t\t\tthis.createTask(this.latest.androidLink);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.showToast('未找到下载地址');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this.latest.iosLink && this.latest.iosLink !== '#') {\r\n\t\t\t\t\t// 我这里默认#也是没有地址，请根据业务自行修改\r\n\t\t\t\t\t// 苹果(A)：进行热更新（如果iosLink是wgt更新包的下载地址）判断文件名中是否含有.wgt\r\n\t\t\t\t\tif (this.latest.iosLink.match(RegExp(/.wgt/))) {\r\n\t\t\t\t\t\tthis.createTask(this.latest.iosLink);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 苹果(B)：打开商店链接（如果iosLink是苹果商店的地址）\r\n\t\t\t\t\t\tplus.runtime.openURL(this.latest.iosLink);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.showToast('未找到ios商店地址');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.flex-column {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n.content {\r\n\t/* background-image: var(--gradualBlue);\n\tcolor: var(--white); */\r\n\t/* bg-gradual-blue; */\r\n\r\n\tbackground-color: #ffffff;\r\n\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\talign-content: center;\r\n\tflex-direction: column;\r\n\tjustify-content: center;\r\n\tflex: 1;\r\n}\r\n.minorContent {\r\n\twidth: 650upx;\r\n\tpadding: 50upx 50upx;\r\n}\r\n.process {\r\n\tmargin-top: 200upx;\r\n\tmargin-left: 30%;\r\n}\r\n.logo {\r\n\theight: 200upx;\r\n\twidth: 200upx;\r\n\tmargin-top: 100upx;\r\n}\r\n.title {\r\n\tfont-size: 36upx;\r\n\tcolor: #373737;\r\n\tfont-weight: bold;\r\n}\r\n.infoTitle {\r\n\tfont-size: 32upx;\r\n\tcolor: #373737;\r\n\tpadding-left: 15upx;\r\n\tfont-weight: bold;\r\n}\r\n.tip {\r\n\tfont-size: 28upx;\r\n\tcolor: #7e7e83;\r\n\tvertical-align: text-top;\r\n}\r\n.bottom_aera {\r\n\tposition: absolute;\r\n\tbottom: 0;\r\n\theight: 12%;\r\n}\r\n.line {\r\n\tpadding: 0 200upx;\r\n\tborder-bottom: 2upx solid #d8d8d8;\r\n}\r\n.infoPic {\r\n\theight: 50upx;\r\n\twidth: 50upx;\r\n}\r\n.infoContentTitle {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tpadding: 20upx 40upx;\r\n}\r\n.infoContent {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n}\r\n.updateInfo {\r\n\tfont-size: 28upx;\r\n\tcolor: #7e7e83;\r\n\tpadding: 0 80upx;\r\n}\r\n.smallTitle {\r\n\tfont-size: 26upx;\r\n\tfont-weight: 500;\r\n\tpadding: 20upx 0;\r\n\tline-height: 1.5;\r\n\tcolor: #888;\r\n}\r\n</style>\n","import mod from \"-!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=style&index=0&id=0e7ddb05&scoped=true&lang=css&\"; export default mod; export * from \"-!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\InstallCatalog\\\\HBuilderX\\\\HBuilderX.3.1.18.20210609.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=style&index=0&id=0e7ddb05&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1627091028521\n      var cssReload = require(\"D:/InstallCatalog/HBuilderX/HBuilderX.3.1.18.20210609.full/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}